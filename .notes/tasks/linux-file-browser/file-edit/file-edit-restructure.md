# æ–‡ä»¶ç¼–è¾‘å™¨é‡æ„è®¾è®¡æ–‡æ¡£

## ä¸€ã€åŒæ¨¡å¼æ¶æ„è®¾è®¡

### 1. æ¨¡å¼å®šä¹‰

#### æµè§ˆæ¨¡å¼ï¼ˆé»˜è®¤ï¼‰
- **æ ¸å¿ƒç‰¹ç‚¹**ï¼šé«˜æ•ˆå¤„ç†å¤§æ–‡ä»¶ï¼ŒæŒ‰éœ€åŠ è½½å†…å®¹
- **é€‚ç”¨åœºæ™¯**ï¼šæŸ¥çœ‹å¤§å‹æ—¥å¿—æ–‡ä»¶ã€åªè¯»æ“ä½œã€éœ€è¦è¿‡æ»¤çš„åœºæ™¯
- **æŠ€æœ¯å®ç°**ï¼šåŸºäºç³»ç»Ÿå‘½ä»¤çš„åˆ†å—åŠ è½½ï¼Œè™šæ‹Ÿæ»šåŠ¨æ¸²æŸ“
- **å†…å­˜å ç”¨**ï¼šæœ€å°åŒ–ï¼Œä»…åŠ è½½å¯è§†åŒºåŸŸå†…å®¹

#### ç¼–è¾‘æ¨¡å¼
- **æ ¸å¿ƒç‰¹ç‚¹**ï¼šå®Œæ•´åŠ è½½æ–‡ä»¶ï¼Œæ”¯æŒå…¨æ–‡ç¼–è¾‘
- **é€‚ç”¨åœºæ™¯**ï¼šéœ€è¦ä¿®æ”¹æ–‡ä»¶å†…å®¹ã€æŸ¥æ‰¾æ›¿æ¢æ“ä½œ
- **æŠ€æœ¯å®ç°**ï¼šå®Œæ•´åŠ è½½æ–‡ä»¶åˆ°å†…å­˜ï¼Œä½¿ç”¨ç¼–è¾‘å™¨ç»„ä»¶
- **å†…å­˜å ç”¨**ï¼šè¾ƒé«˜ï¼Œéœ€è¦å®Œæ•´åŠ è½½æ–‡ä»¶

### 2. æ¨¡å¼åˆ‡æ¢æœºåˆ¶

#### ä»æµè§ˆæ¨¡å¼åˆ°ç¼–è¾‘æ¨¡å¼
- **è§¦å‘æ–¹å¼**ï¼šç‚¹å‡»"ç¼–è¾‘"æŒ‰é’®
- **ç¡®è®¤æµç¨‹**ï¼š
  ```
  +------------------------------------------+
  | âš ï¸ åˆ‡æ¢åˆ°ç¼–è¾‘æ¨¡å¼                        |
  | å°†å®Œæ•´åŠ è½½æ–‡ä»¶(10MB)åˆ°å†…å­˜ä¸­ï¼Œå¯èƒ½éœ€è¦ä¸€äº›æ—¶é—´ |
  | [ç¡®è®¤] [å–æ¶ˆ]                            |
  +------------------------------------------+
  ```
- **å¤§æ–‡ä»¶è­¦å‘Š**ï¼šæ–‡ä»¶å¤§äº10MBæ—¶æ˜¾ç¤ºè­¦å‘Š
- **åŠ è½½è¿‡ç¨‹**ï¼šæ˜¾ç¤ºè¿›åº¦æ¡ï¼Œå¯å–æ¶ˆæ“ä½œ

#### ä»ç¼–è¾‘æ¨¡å¼åˆ°æµè§ˆæ¨¡å¼
- **è§¦å‘æ–¹å¼**ï¼šç‚¹å‡»"æµè§ˆæ¨¡å¼"æŒ‰é’®
- **ç¡®è®¤æµç¨‹**ï¼šå¦‚æœ‰æœªä¿å­˜æ›´æ”¹ï¼Œæç¤ºä¿å­˜
- **èµ„æºé‡Šæ”¾**ï¼šé‡Šæ”¾ç¼–è¾‘å™¨å ç”¨çš„å†…å­˜

## äºŒã€åŠŸèƒ½å®ç°å¯¹æ¯”

### 1. å†…å®¹åŠ è½½

| åŠŸèƒ½ | æµè§ˆæ¨¡å¼ | ç¼–è¾‘æ¨¡å¼ |
|------|---------|---------|
| **åŠ è½½æ–¹å¼** | åˆ†å—æŒ‰éœ€åŠ è½½ | å®Œæ•´åŠ è½½ |
| **å®ç°æŠ€æœ¯** | ç³»ç»Ÿå‘½ä»¤(head/tail) | æ–‡ä»¶è¯»å–API |
| **å†…å­˜å ç”¨** | ä½ | é«˜ |
| **åŠ è½½é€Ÿåº¦** | å¿« | æ…¢(å¤§æ–‡ä»¶) |
| **é€‚ç”¨æ–‡ä»¶å¤§å°** | ä¸é™ | å»ºè®®<100MB |

### 2. è¿‡æ»¤åŠŸèƒ½

| åŠŸèƒ½ | æµè§ˆæ¨¡å¼ | ç¼–è¾‘æ¨¡å¼ |
|------|---------|---------|
| **å®ç°æ–¹å¼** | grepå‘½ä»¤ | å†…å­˜ä¸­è¿‡æ»¤ |
| **è¿‡æ»¤èŒƒå›´** | æ•´ä¸ªæ–‡ä»¶ | å·²åŠ è½½å†…å®¹ |
| **è¿‡æ»¤é€Ÿåº¦** | å¿« | å—æ–‡ä»¶å¤§å°å½±å“ |
| **ç»“æœå±•ç¤º** | ä»…æ˜¾ç¤ºåŒ¹é…è¡Œ | é«˜äº®æ˜¾ç¤ºåŒ¹é…è¡Œ |
| **ä¸Šä¸‹æ–‡è¡Œ** | å¯é€‰æ˜¾ç¤º | å§‹ç»ˆå¯è§ |

### 3. æœç´¢åŠŸèƒ½

| åŠŸèƒ½ | æµè§ˆæ¨¡å¼ | ç¼–è¾‘æ¨¡å¼ |
|------|---------|---------|
| **å®ç°æ–¹å¼** | grepå‘½ä»¤ | ç¼–è¾‘å™¨å†…ç½®æœç´¢ |
| **æœç´¢èŒƒå›´** | æ•´ä¸ªæ–‡ä»¶ | å·²åŠ è½½å†…å®¹ |
| **æœç´¢é€Ÿåº¦** | å¿« | å—æ–‡ä»¶å¤§å°å½±å“ |
| **ç»“æœå¯¼èˆª** | åŸºäºè¡Œå·è·³è½¬ | ç¼–è¾‘å™¨å†…ç½®å¯¼èˆª |
| **æ›¿æ¢åŠŸèƒ½** | ä¸æ”¯æŒ | æ”¯æŒ |

### 4. å®æ—¶æ›´æ–°

| åŠŸèƒ½ | æµè§ˆæ¨¡å¼ | ç¼–è¾‘æ¨¡å¼ |
|------|---------|---------|
| **å®ç°æ–¹å¼** | tail -få‘½ä»¤ | æ–‡ä»¶ç›‘æ§+é‡æ–°åŠ è½½ |
| **æ›´æ–°æ•ˆç‡** | é«˜ | ä½(éœ€é‡æ–°åŠ è½½) |
| **å†…å­˜å½±å“** | æœ€å° | å¯èƒ½å¢åŠ  |
| **UIæ›´æ–°** | å¢é‡æ·»åŠ  | å®Œå…¨åˆ·æ–° |

## ä¸‰ã€å¤šæ ‡ç­¾çŠ¶æ€ç®¡ç†è®¾è®¡

### 1. æ ‡ç­¾æ•°æ®ç»“æ„

```typescript
interface EditorTab {
  id: string;                 // å”¯ä¸€æ ‡è¯†
  filePath: string;           // æ–‡ä»¶è·¯å¾„
  sessionId: string;          // ä¼šè¯ID
  title: string;              // æ˜¾ç¤ºæ ‡é¢˜
  mode: 'browse' | 'edit';    // å½“å‰æ¨¡å¼
  isActive: boolean;          // æ˜¯å¦æ¿€æ´»
  isModified: boolean;        // æ˜¯å¦å·²ä¿®æ”¹
  viewState: {                // è§†å›¾çŠ¶æ€
    scrollPosition: number;   // æ»šåŠ¨ä½ç½®
    filterText?: string;      // è¿‡æ»¤æ–‡æœ¬
    searchText?: string;      // æœç´¢æ–‡æœ¬
    isRealtime: boolean;      // æ˜¯å¦å®æ—¶æ¨¡å¼
  };
  fileState: {                // æ–‡ä»¶çŠ¶æ€
    size: number;             // æ–‡ä»¶å¤§å°
    lastModified: number;     // æœ€åä¿®æ”¹æ—¶é—´
    encoding: string;         // æ–‡ä»¶ç¼–ç 
    totalLines?: number;      // æ€»è¡Œæ•°(å¯èƒ½æœªçŸ¥)
  };
  editorState?: {             // ç¼–è¾‘æ¨¡å¼çŠ¶æ€
    content?: string;         // æ–‡ä»¶å†…å®¹
    selections?: any[];       // é€‰åŒºä¿¡æ¯
    undoStack?: any[];        // æ’¤é”€æ ˆ
  };
  browseState?: {             // æµè§ˆæ¨¡å¼çŠ¶æ€
    visibleRange: [number, number]; // å¯è§è¡ŒèŒƒå›´
    loadedChunks: {           // å·²åŠ è½½å—
      [key: string]: {
        range: [number, number];
        content: string[];
      }
    };
  };
}
```

### 2. æ ‡ç­¾ç®¡ç†å™¨è®¾è®¡

```typescript
interface ITabManager {
  // æ ‡ç­¾åŸºæœ¬æ“ä½œ
  addTab(options: TabOptions): string;
  closeTab(tabId: string): Promise<boolean>;
  activateTab(tabId: string): void;
  
  // æ ‡ç­¾çŠ¶æ€ç®¡ç†
  getTabState(tabId: string): EditorTab;
  updateTabState(tabId: string, updates: Partial<EditorTab>): void;
  
  // æ¨¡å¼åˆ‡æ¢
  switchTabMode(tabId: string, mode: 'browse' | 'edit'): Promise<boolean>;
  
  // æ ‡ç­¾å†…å®¹æ“ä½œ
  saveTabContent(tabId: string): Promise<boolean>;
  reloadTabContent(tabId: string): Promise<boolean>;
  
  // æ ‡ç­¾äº‹ä»¶
  onTabActivated(callback: (tab: EditorTab) => void): void;
  onTabClosed(callback: (tabId: string) => void): void;
  onTabModeChanged(callback: (tab: EditorTab, prevMode: string) => void): void;
  onTabStateChanged(callback: (tab: EditorTab, changes: object) => void): void;
}
```

### 3. æ ‡ç­¾çŠ¶æ€åŒæ­¥æœºåˆ¶

#### æœ¬åœ°çŠ¶æ€åŒæ­¥
- **å†…å­˜ä¸­çŠ¶æ€**ï¼šä½¿ç”¨MobXç®¡ç†å¯è§‚å¯ŸçŠ¶æ€
- **æŒä¹…åŒ–çŠ¶æ€**ï¼šå®šæœŸä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
- **ä¼šè¯æ¢å¤**ï¼šåº”ç”¨å¯åŠ¨æ—¶æ¢å¤ä¸Šæ¬¡ä¼šè¯

#### çª—å£é—´çŠ¶æ€åŒæ­¥
- **IPCé€šä¿¡**ï¼šä½¿ç”¨Electron IPCåœ¨ä¸»è¿›ç¨‹å’Œæ¸²æŸ“è¿›ç¨‹é—´åŒæ­¥
- **äº‹ä»¶å¹¿æ’­**ï¼šæ ‡ç­¾çŠ¶æ€å˜æ›´æ—¶å¹¿æ’­åˆ°æ‰€æœ‰ç›¸å…³çª—å£
- **å†²çªå¤„ç†**ï¼šåŸºäºæ—¶é—´æˆ³å’Œç‰ˆæœ¬å·è§£å†³å†²çª

### 4. æ ‡ç­¾ç”Ÿå‘½å‘¨æœŸç®¡ç†

```
+-------------------+
| åˆ›å»ºæ ‡ç­¾(æµè§ˆæ¨¡å¼) |
+-------------------+
         |
         v
+-------------------+     +-------------------+
| æµè§ˆæ¨¡å¼çŠ¶æ€      | --> | åˆ‡æ¢åˆ°ç¼–è¾‘æ¨¡å¼    |
+-------------------+     +-------------------+
         |                        |
         v                        v
+-------------------+     +-------------------+
| æ›´æ–°æµè§ˆçŠ¶æ€      |     | ç¼–è¾‘æ¨¡å¼çŠ¶æ€      |
+-------------------+     +-------------------+
         |                        |
         v                        v
+-------------------+     +-------------------+
| å…³é—­æ ‡ç­¾(æµè§ˆ)    |     | ä¿å­˜æ–‡ä»¶          |
+-------------------+     +-------------------+
                                  |
                                  v
                          +-------------------+
                          | å…³é—­æ ‡ç­¾(ç¼–è¾‘)    |
                          +-------------------+
```

## å››ã€UIè®¾è®¡æ›´æ–°

### 1. æ¨¡å¼åˆ‡æ¢æ§ä»¶

```
+------------------------------------------+
| [ğŸ‘ï¸ æµè§ˆ] | [âœï¸ ç¼–è¾‘] | [ğŸ”„ åˆ·æ–°] | [ğŸ’¾ ä¿å­˜] |
+------------------------------------------+
```

### 2. æ ‡ç­¾æ è®¾è®¡

```
+-----+-----+-----+-----+-----+
| T1  | T2* | T3  | T4E | +   |
+-----+-----+-----+-----+-----+
```

- **æ ‡ç­¾çŠ¶æ€æŒ‡ç¤º**ï¼š
  - `*` - å·²ä¿®æ”¹
  - `E` - ç¼–è¾‘æ¨¡å¼
  - é»˜è®¤ - æµè§ˆæ¨¡å¼

### 3. æ¨¡å¼æŒ‡ç¤ºå™¨

```
+------------------------------------------+
| ğŸ“„ æµè§ˆæ¨¡å¼ - å·²åŠ è½½: 2MB/10MB (20%)     |
+------------------------------------------+

+------------------------------------------+
| âœï¸ ç¼–è¾‘æ¨¡å¼ - å·²åŠ è½½: 10MB/10MB (100%)    |
+------------------------------------------+
```

## äº”ã€æŠ€æœ¯å®ç°ç»†èŠ‚

### 1. æµè§ˆæ¨¡å¼æ ¸å¿ƒå®ç°

```typescript
class BrowseMode {
  // åˆ†å—åŠ è½½
  async loadChunk(start: number, end: number): Promise<string[]> {
    // ä½¿ç”¨ç³»ç»Ÿå‘½ä»¤è·å–æŒ‡å®šèŒƒå›´çš„è¡Œ
    return this.executeCommand(`sed -n '${start},${end}p' "${this.filePath}"`);
  }
  
  // è¿‡æ»¤å®ç°
  async applyFilter(pattern: string): Promise<FilterResult> {
    // ä½¿ç”¨grepå‘½ä»¤è¿‡æ»¤
    return this.executeCommand(`grep -n "${pattern}" "${this.filePath}"`);
  }
  
  // æœç´¢å®ç°
  async search(pattern: string): Promise<SearchResult[]> {
    // ä½¿ç”¨grepå‘½ä»¤æœç´¢
    return this.executeCommand(`grep -n "${pattern}" "${this.filePath}"`);
  }
  
  // å®æ—¶æ›´æ–°
  startRealtime(): void {
    // ä½¿ç”¨tail -få‘½ä»¤ç›‘æ§æ–‡ä»¶å˜åŒ–
    this.realtimeProcess = this.executeCommand(`tail -f "${this.filePath}"`, true);
  }
}
```

### 2. ç¼–è¾‘æ¨¡å¼æ ¸å¿ƒå®ç°

```typescript
class EditMode {
  // å®Œæ•´åŠ è½½æ–‡ä»¶
  async loadFile(): Promise<string> {
    return fs.promises.readFile(this.filePath, this.encoding);
  }
  
  // åˆå§‹åŒ–ç¼–è¾‘å™¨
  initEditor(container: HTMLElement, content: string): void {
    this.editor = monaco.editor.create(container, {
      value: content,
      language: this.detectLanguage(),
      theme: 'vs-dark'
    });
  }
  
  // ä¿å­˜æ–‡ä»¶
  async saveFile(): Promise<boolean> {
    const content = this.editor.getValue();
    await fs.promises.writeFile(this.filePath, content, this.encoding);
    return true;
  }
}
```

### 3. æ¨¡å¼åˆ‡æ¢å®ç°

```typescript
class FileEditorManager {
  // åˆ‡æ¢åˆ°ç¼–è¾‘æ¨¡å¼
  async switchToEditMode(): Promise<boolean> {
    // æ˜¾ç¤ºç¡®è®¤å¯¹è¯æ¡†
    if (this.fileState.size > 10 * 1024 * 1024) { // 10MB
      const confirm = await this.showConfirmDialog(
        `åˆ‡æ¢åˆ°ç¼–è¾‘æ¨¡å¼å°†åŠ è½½æ•´ä¸ªæ–‡ä»¶(${this.formatSize(this.fileState.size)})åˆ°å†…å­˜ä¸­ï¼Œå¯èƒ½éœ€è¦ä¸€äº›æ—¶é—´ã€‚æ˜¯å¦ç»§ç»­ï¼Ÿ`
      );
      if (!confirm) return false;
    }
    
    // æ˜¾ç¤ºåŠ è½½è¿›åº¦
    this.showProgress();
    
    try {
      // åŠ è½½æ•´ä¸ªæ–‡ä»¶
      const content = await this.editMode.loadFile();
      
      // åˆå§‹åŒ–ç¼–è¾‘å™¨
      this.editMode.initEditor(this.container, content);
      
      // æ›´æ–°çŠ¶æ€
      this.currentMode = 'edit';
      this.updateTabState({ mode: 'edit' });
      
      return true;
    } catch (error) {
      this.showError(`åŠ è½½æ–‡ä»¶å¤±è´¥: ${error.message}`);
      return false;
    } finally {
      this.hideProgress();
    }
  }
  
  // åˆ‡æ¢åˆ°æµè§ˆæ¨¡å¼
  async switchToBrowseMode(): Promise<boolean> {
    // æ£€æŸ¥æ˜¯å¦æœ‰æœªä¿å­˜çš„æ›´æ”¹
    if (this.editMode.isDirty()) {
      const action = await this.showSaveDialog();
      if (action === 'cancel') return false;
      if (action === 'save') {
        await this.editMode.saveFile();
      }
    }
    
    // é‡Šæ”¾ç¼–è¾‘å™¨èµ„æº
    this.editMode.dispose();
    
    // åˆå§‹åŒ–æµè§ˆæ¨¡å¼
    await this.browseMode.initialize();
    
    // æ›´æ–°çŠ¶æ€
    this.currentMode = 'browse';
    this.updateTabState({ mode: 'browse' });
    
    return true;
  }
}
```

## å…­ã€å¤šæ ‡ç­¾çŠ¶æ€ç®¡ç†å®ç°

### 1. æ ‡ç­¾å­˜å‚¨å®ç°

```typescript
class TabStore {
  @observable tabs: Map<string, EditorTab> = new Map();
  @observable activeTabId: string | null = null;
  
  @action
  addTab(tab: EditorTab): void {
    this.tabs.set(tab.id, tab);
    this.setActiveTab(tab.id);
  }
  
  @action
  updateTab(tabId: string, updates: Partial<EditorTab>): void {
    const tab = this.tabs.get(tabId);
    if (tab) {
      this.tabs.set(tabId, { ...tab, ...updates });
      this.notifyTabChanged(tabId, updates);
    }
  }
  
  @action
  setActiveTab(tabId: string): void {
    // å°†å½“å‰æ´»è·ƒæ ‡ç­¾è®¾ä¸ºéæ´»è·ƒ
    if (this.activeTabId) {
      const currentTab = this.tabs.get(this.activeTabId);
      if (currentTab) {
        this.tabs.set(this.activeTabId, { ...currentTab, isActive: false });
      }
    }
    
    // è®¾ç½®æ–°çš„æ´»è·ƒæ ‡ç­¾
    const newActiveTab = this.tabs.get(tabId);
    if (newActiveTab) {
      this.tabs.set(tabId, { ...newActiveTab, isActive: true });
      this.activeTabId = tabId;
      this.notifyTabActivated(tabId);
    }
  }
  
  @action
  removeTab(tabId: string): void {
    this.tabs.delete(tabId);
    
    // å¦‚æœå…³é—­çš„æ˜¯å½“å‰æ´»è·ƒæ ‡ç­¾ï¼Œåˆ™æ¿€æ´»ä¸‹ä¸€ä¸ªæ ‡ç­¾
    if (this.activeTabId === tabId) {
      const remainingTabs = Array.from(this.tabs.keys());
      if (remainingTabs.length > 0) {
        this.setActiveTab(remainingTabs[0]);
      } else {
        this.activeTabId = null;
      }
    }
    
    this.notifyTabClosed(tabId);
  }
  
  // äº‹ä»¶é€šçŸ¥
  private notifyTabChanged(tabId: string, changes: object): void {
    // é€šè¿‡IPCé€šçŸ¥å…¶ä»–çª—å£
    ipcRenderer.send('tab-state-changed', { tabId, changes });
  }
  
  private notifyTabActivated(tabId: string): void {
    ipcRenderer.send('tab-activated', { tabId });
  }
  
  private notifyTabClosed(tabId: string): void {
    ipcRenderer.send('tab-closed', { tabId });
  }
}
```

### 2. æ ‡ç­¾åŒæ­¥æœºåˆ¶

```typescript
// ä¸»è¿›ç¨‹ä¸­çš„æ ‡ç­¾åŒæ­¥ç®¡ç†
class TabSyncManager {
  // å­˜å‚¨æ‰€æœ‰çª—å£çš„æ ‡ç­¾çŠ¶æ€
  private tabStates: Map<string, EditorTab> = new Map();
  // å­˜å‚¨æ ‡ç­¾ä¸çª—å£çš„å…³ç³»
  private tabWindows: Map<string, BrowserWindow[]> = new Map();
  
  constructor() {
    // ç›‘å¬æ ‡ç­¾çŠ¶æ€å˜æ›´
    ipcMain.on('tab-state-changed', (event, { tabId, changes }) => {
      this.updateTabState(tabId, changes);
      this.broadcastTabState(tabId, event.sender);
    });
    
    // ç›‘å¬æ ‡ç­¾æ¿€æ´»
    ipcMain.on('tab-activated', (event, { tabId }) => {
      this.broadcastTabActivation(tabId, event.sender);
    });
    
    // ç›‘å¬æ ‡ç­¾å…³é—­
    ipcMain.on('tab-closed', (event, { tabId }) => {
      this.removeTabState(tabId);
      this.broadcastTabClosure(tabId, event.sender);
    });
  }
  
  // æ›´æ–°æ ‡ç­¾çŠ¶æ€
  private updateTabState(tabId: string, changes: object): void {
    const currentState = this.tabStates.get(tabId) || {};
    this.tabStates.set(tabId, { ...currentState, ...changes });
  }
  
  // ç§»é™¤æ ‡ç­¾çŠ¶æ€
  private removeTabState(tabId: string): void {
    this.tabStates.delete(tabId);
    this.tabWindows.delete(tabId);
  }
  
  // å¹¿æ’­æ ‡ç­¾çŠ¶æ€å˜æ›´åˆ°å…¶ä»–çª—å£
  private broadcastTabState(tabId: string, sender: WebContents): void {
    const windows = this.tabWindows.get(tabId) || [];
    const state = this.tabStates.get(tabId);
    
    if (state) {
      for (const win of windows) {
        if (win.webContents !== sender) {
          win.webContents.send('tab-state-updated', { tabId, state });
        }
      }
    }
  }
  
  // å¹¿æ’­æ ‡ç­¾æ¿€æ´»åˆ°å…¶ä»–çª—å£
  private broadcastTabActivation(tabId: string, sender: WebContents): void {
    const windows = this.tabWindows.get(tabId) || [];
    
    for (const win of windows) {
      if (win.webContents !== sender) {
        win.webContents.send('tab-activated', { tabId });
      }
    }
  }
  
  // å¹¿æ’­æ ‡ç­¾å…³é—­åˆ°å…¶ä»–çª—å£
  private broadcastTabClosure(tabId: string, sender: WebContents): void {
    const windows = this.tabWindows.get(tabId) || [];
    
    for (const win of windows) {
      if (win.webContents !== sender) {
        win.webContents.send('tab-closed', { tabId });
      }
    }
  }
  
  // æ³¨å†Œçª—å£ä¸æ ‡ç­¾çš„å…³ç³»
  registerTabWindow(tabId: string, window: BrowserWindow): void {
    const windows = this.tabWindows.get(tabId) || [];
    if (!windows.includes(window)) {
      windows.push(window);
      this.tabWindows.set(tabId, windows);
    }
  }
  
  // å–æ¶ˆæ³¨å†Œçª—å£ä¸æ ‡ç­¾çš„å…³ç³»
  unregisterTabWindow(tabId: string, window: BrowserWindow): void {
    const windows = this.tabWindows.get(tabId) || [];
    const index = windows.indexOf(window);
    
    if (index !== -1) {
      windows.splice(index, 1);
      if (windows.length === 0) {
        this.tabWindows.delete(tabId);
      } else {
        this.tabWindows.set(tabId, windows);
      }
    }
  }
}
```

## ä¸ƒã€æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### 1. æµè§ˆæ¨¡å¼ä¼˜åŒ–
- **å‘½ä»¤æ‰§è¡Œä¼˜åŒ–**ï¼šä½¿ç”¨æµå¼å¤„ç†å‡å°‘å†…å­˜å ç”¨
- **ç»“æœç¼“å­˜**ï¼šç¼“å­˜å¸¸ç”¨å‘½ä»¤ç»“æœå‡å°‘é‡å¤æ‰§è¡Œ
- **è™šæ‹Ÿæ»šåŠ¨**ï¼šåªæ¸²æŸ“å¯è§†åŒºåŸŸå†…å®¹
- **åå°é¢„åŠ è½½**ï¼šé¢„æµ‹ç”¨æˆ·æ»šåŠ¨æ–¹å‘ï¼Œæå‰åŠ è½½å†…å®¹

### 2. ç¼–è¾‘æ¨¡å¼ä¼˜åŒ–
- **åˆ†å—æ¸²æŸ“**ï¼šå¤§æ–‡ä»¶åˆ†å—æ¸²æŸ“å‡å°‘DOMèŠ‚ç‚¹æ•°é‡
- **å»¶è¿Ÿè¯­æ³•é«˜äº®**ï¼šä¼˜å…ˆæ¸²æŸ“å†…å®¹ï¼Œå»¶è¿Ÿåº”ç”¨è¯­æ³•é«˜äº®
- **ç¼–è¾‘å™¨é…ç½®ä¼˜åŒ–**ï¼šç¦ç”¨ä¸å¿…è¦çš„ç‰¹æ€§æé«˜æ€§èƒ½
- **å†…å­˜ç›‘æ§**ï¼šç›‘æ§å†…å­˜ä½¿ç”¨ï¼Œå¿…è¦æ—¶é‡Šæ”¾èµ„æº

### 3. å¤šæ ‡ç­¾ä¼˜åŒ–
- **æ ‡ç­¾çŠ¶æ€æ‡’åŠ è½½**ï¼šåªåŠ è½½æ´»è·ƒæ ‡ç­¾çš„å®Œæ•´çŠ¶æ€
- **éæ´»è·ƒæ ‡ç­¾èµ„æºé‡Šæ”¾**ï¼šé‡Šæ”¾éæ´»è·ƒæ ‡ç­¾å ç”¨çš„èµ„æº
- **æ ‡ç­¾æ•°é‡é™åˆ¶**ï¼šé™åˆ¶åŒæ—¶æ‰“å¼€çš„æ ‡ç­¾æ•°é‡
- **æ ‡ç­¾çŠ¶æ€å‹ç¼©å­˜å‚¨**ï¼šå‹ç¼©å­˜å‚¨æ ‡ç­¾çŠ¶æ€å‡å°‘å†…å­˜å ç”¨

## å…«ã€å®æ–½è·¯çº¿å›¾

### ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€æ¶æ„é‡æ„
1. å®ç°åŒæ¨¡å¼åŸºç¡€æ¶æ„
2. å®Œå–„æµè§ˆæ¨¡å¼å‘½ä»¤æ‰§è¡Œ
3. å®ç°åŸºæœ¬çš„æ ‡ç­¾ç®¡ç†

### ç¬¬äºŒé˜¶æ®µï¼šåŠŸèƒ½å®Œå–„
1. å®ç°ç¼–è¾‘æ¨¡å¼å®Œæ•´åŠŸèƒ½
2. å®Œå–„æ¨¡å¼åˆ‡æ¢æœºåˆ¶
3. å®ç°å¤šæ ‡ç­¾çŠ¶æ€åŒæ­¥

### ç¬¬ä¸‰é˜¶æ®µï¼šä¼˜åŒ–ä¸å¢å¼º
1. æ€§èƒ½ä¼˜åŒ–
2. ç”¨æˆ·ç•Œé¢ä¼˜åŒ–
3. é”™è¯¯å¤„ç†ä¸æ¢å¤æœºåˆ¶
4. ç”¨æˆ·ä½“éªŒæ”¹è¿›

## ä¹ã€æ€»ç»“

æœ¬é‡æ„æ–¹æ¡ˆé€šè¿‡å¼•å…¥æµè§ˆæ¨¡å¼å’Œç¼–è¾‘æ¨¡å¼çš„åŒæ¨¡å¼è®¾è®¡ï¼Œç»“åˆå®Œå–„çš„å¤šæ ‡ç­¾çŠ¶æ€ç®¡ç†ï¼Œå¯ä»¥æœ‰æ•ˆè§£å†³å¤§æ–‡ä»¶å¤„ç†çš„æ€§èƒ½é—®é¢˜ï¼ŒåŒæ—¶ä¿æŒè‰¯å¥½çš„ç”¨æˆ·ä½“éªŒã€‚æµè§ˆæ¨¡å¼ä¸“æ³¨äºé«˜æ•ˆçš„æ–‡ä»¶æŸ¥çœ‹å’Œè¿‡æ»¤ï¼Œè€Œç¼–è¾‘æ¨¡å¼åˆ™æä¾›å®Œæ•´çš„ç¼–è¾‘åŠŸèƒ½ã€‚å¤šæ ‡ç­¾çŠ¶æ€ç®¡ç†ç¡®ä¿äº†åœ¨å¤æ‚åœºæ™¯ä¸‹çš„çŠ¶æ€ä¸€è‡´æ€§å’Œç”¨æˆ·æ“ä½œçš„å¯é æ€§ã€‚

è¯¥æ–¹æ¡ˆå€Ÿé‰´äº†ä¸»æµç¼–è¾‘å™¨çš„è®¾è®¡ç†å¿µï¼ŒåŒæ—¶é’ˆå¯¹è¿œç¨‹æ–‡ä»¶ç¼–è¾‘çš„ç‰¹æ®Šéœ€æ±‚è¿›è¡Œäº†ä¼˜åŒ–ï¼Œæ˜¯ä¸€ä¸ªå¹³è¡¡æ€§èƒ½å’ŒåŠŸèƒ½çš„å®ç”¨è§£å†³æ–¹æ¡ˆã€‚ 