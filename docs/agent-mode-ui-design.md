# Agent 模式 UI 设计方案

## 一、设计原则

1. **安全性**
   - 所有命令必须经过用户确认后才能执行
   - 命令仅在当前活动的 SSH 标签页中执行
   - 高风险操作需要额外确认步骤
   - 清晰展示每个命令的预期影响

2. **一致性**
   - 继承上下文模式的命令执行机制
   - 保持现有的对话界面布局和样式
   - 复用已有的命令确认和执行组件
   - 统一的视觉语言和交互模式

3. **可视化**
   - 智能体思考和分析过程的实时反馈
   - 任务执行状态和进度的清晰展示
   - 多轮分析结果的层级展示

## 二、界面布局

### 2.1 模式切换区
```
┌─────────────────────────────────────┐
│  命令模式 | 上下文模式 | Agent模式  │
└─────────────────────────────────────┘
```

### 2.2 对话区域
```
┌─────────────────────────────────────┐
│                                     │
│  [用户输入]                         │
│  请帮我排查CPU占用高的问题          │
│                                     │
│  [Agent响应 - 思考中...]           │
│  ┌─────────────────────┐           │
│  │ 任务分析:           │           │
│  │ 我将帮您排查CPU占用  │           │
│  │ 问题,需要执行以下    │           │
│  │ 步骤...             │           │
│  └─────────────────────┘           │
│                                     │
│  [Agent响应 - 等待执行命令]         │
│  ┌─────────────────────┐           │
│  │ 第一步：获取系统概况 │           │
│  │ 建议执行: top -bn1  │           │
│  │                     │           │
│  │ [执行命令] [跳过]   │           │
│  └─────────────────────┘           │
│                                     │
│  [命令输出]                         │
│  ┌─────────────────────┐           │
│  │ top - 14:23:45...   │           │
│  └─────────────────────┘           │
│                                     │
│  [Agent响应 - 分析中...]           │
│  ┌─────────────────────┐           │
│  │ 分析发现：          │           │
│  │ 1. Java进程占用80%  │           │
│  │ 2. 疑似内存泄漏     │           │
│  └─────────────────────┘           │
│                                     │
│  [Agent响应 - 等待执行命令]         │
│  ┌─────────────────────┐           │
│  │ 第二步：查看详细信息 │           │
│  │ 建议执行:           │           │
│  │ ps aux | grep java  │           │
│  │                     │           │
│  │ [执行命令] [跳过]   │           │
│  └─────────────────────┘           │
│                                     │
└─────────────────────────────────────┘
```

### 2.3 命令执行状态
```
┌─────────────────────────────────────┐
│ 执行位置: 当前活动终端 (SSH-DEV-01) │
│ 执行状态: 等待用户确认              │
└─────────────────────────────────────┘
```

## 三、交互流程

### 3.1 命令执行流程
1. **命令提议**
   - Agent 提出命令建议
   - 显示命令的目的和预期结果
   - 提供命令说明和风险提示

2. **用户确认**
   - 显示 [执行命令] 按钮
   - 提供 [跳过] 选项
   - 支持命令修改（复用上下文模式的编辑功能）

3. **执行反馈**
   - 命令执行状态提示
   - 输出结果实时显示
   - 错误信息醒目提示

4. **分析展示**
   - 显示分析进度（loading）
   - 分析结果逐步呈现
   - 关键发现高亮显示

### 3.2 视觉反馈
1. **状态指示**
   - 思考中：显示旋转loading图标
   - 等待执行：突出显示命令按钮
   - 执行中：进度条或loading
   - 分析中：波浪loading动画

2. **消息分层**
   - 用户输入：白色背景
   - Agent分析：浅蓝背景
   - 命令区域：深色背景
   - 执行结果：浅灰背景

## 四、组件复用

### 4.1 复用现有组件
- 命令执行按钮
- 命令编辑器
- 终端输出展示
- 错误提示框

### 4.2 新增组件
- 任务进度指示器
- 智能体状态展示
- 分析结果卡片
- 步骤导航器

## 五、安全考虑

### 5.1 命令执行安全
- 仅在当前活动终端执行
- 命令执行前显示预览
- 危险命令特殊标记
- 执行权限验证

### 5.2 用户控制
- 支持随时终止分析
- 允许跳过特定步骤
- 提供回滚机制
- 操作日志记录

## 六、性能优化

### 6.1 响应优化
- 分析过程渐进式展示
- 大段输出分片加载
- 非关键信息懒加载
- 状态更新防抖

### 6.2 交互优化
- 命令确认快捷键
- 自动滚动到最新内容
- 状态切换平滑过渡
- 输入建议即时响应 